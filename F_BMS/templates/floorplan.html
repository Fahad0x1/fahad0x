<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Home Floorplan</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .floorplan {
      position: relative;
      background: url("/static/floorplan/floorplan.png") no-repeat center/contain;
      width: 90vw;
      height: 90vh;
    }
    .element {
      position: absolute;
      cursor: pointer;
      transition: transform 0.2s;
      font-size: 24px;
    }
    .element:hover {
      transform: scale(1.3);
    }
  </style>
</head>
<body>
  <div class="floorplan">

    <!-- Lights -->
    <!-- <div class="element" style="top:10%; left:39%" onclick="toggleEntity('switch.sonoff_ab400002a4_1')">💡</div>
    <div class="element" style="top:15%; left:16%" onclick="toggleEntity('switch.sonoff_ab400002a6_1')">💡</div>
    <div class="element" style="top:15%; left:20%" onclick="toggleEntity('switch.sonoff_ab400002a6_2')">💡</div>
    <div class="element" style="top:36%; left:16%" onclick="toggleEntity('switch.sonoff_ab400002a3_2')">💡</div>
    <div class="element" style="top:73%; left:45%" onclick="toggleEntity('switch.sonoff_ab400002a9_2')">💡</div>
    <div class="element" style="top:35%; left:7%" onclick="toggleEntity('switch.sonoff_ab400002a2_3')">💡</div>
    <div class="element" style="top:86%; left:6%" onclick="toggleEntity('switch.sonoff_ab400002a2_4')">💡</div>
    <div class="element" style="top:75%; left:20%" onclick="toggleEntity('switch.sonoff_ab400002a6_3')">💡</div>
    <div class="element" style="top:38%; left:28%" onclick="toggleEntity('switch.sonoff_ab400002a4_3')">💡</div>
    <div class="element" style="top:12%; left:87%" onclick="toggleEntity('switch.sonoff_ab4000029f_1')">💡</div>
    <div class="element" style="top:12%; left:80%" onclick="toggleEntity('switch.sonoff_ab4000029f_3')">💡</div>
    <div class="element" style="top:12%; left:74%" onclick="toggleEntity('switch.sonoff_ab4000029f_4')">💡</div>
    <div class="element" style="top:12%; left:66%" onclick="toggleEntity('switch.sonoff_ab4000029f_2')">💡</div>
    <div class="element" style="top:44%; left:59%" onclick="toggleEntity('switch.sonoff_ab400002a7_4')">💡</div>
    <div class="element" style="top:37%; left:44%" onclick="toggleEntity('switch.sonoff_ab400002a1_1')">💡</div>
    <div class="element" style="top:29%; left:69%" onclick="toggleEntity('switch.sonoff_ab4000028a_1')">💡</div>
    <div class="element" style="top:28%; left:78%" onclick="toggleEntity('switch.sonoff_ab400002a9_3')">💡</div>
    <div class="element" style="top:40%; left:69%" onclick="toggleEntity('switch.sonoff_ab400002a5_3')">💡</div>
    <div class="element" style="top:52%; left:78%" onclick="toggleEntity('switch.sonoff_ab400002a5_4')">💡</div>
    <div class="element" style="top:40%; left:78%" onclick="toggleEntity('switch.sonoff_ab400002a0_1')">💡</div>
    <div class="element" style="top:52%; left:69%" onclick="toggleEntity('switch.sonoff_ab400002a0_2')">💡</div>
    <div class="element" style="top:62%; left:78%" onclick="toggleEntity('switch.sonoff_ab400002a9_1')">💡</div>
    <div class="element" style="top:62%; left:75%" onclick="toggleEntity('switch.sonoff_ab400002a5_2')">💡</div>
    <div class="element" style="top:82%; left:54%" onclick="toggleEntity('switch.sonoff_ab400002a1_3')">💡</div>
    <div class="element" style="top:82%; left:84%" onclick="toggleEntity('switch.sonoff_ab4000029e_3')">💡</div>
    <div class="element" style="top:82%; left:70%" onclick="toggleEntity('switch.sonoff_ab400002a3_4')">💡</div>
    <div class="element" style="top:82%; left:77%" onclick="toggleEntity('switch.sonoff_ab4000029e_2')">💡</div>
    <div class="element" style="top:66%; left:63%" onclick="toggleEntity('switch.sonoff_ab400002a1_4')">💡</div>
    <div class="element" style="top:65%; left:69%" onclick="toggleEntity('switch.sonoff_ab400002a4_2')">💡</div> -->
 <!-- Lights -->
    <div class="element" style="top:8%; left:34%" onclick="toggleEntity('switch.sonoff_ab400002a4_1')">💡</div>
    <div class="element" style="top:13%; left:11%" onclick="toggleEntity('switch.sonoff_ab400002a6_1')">💡</div>
    <div class="element" style="top:13%; left:20%" onclick="toggleEntity('switch.sonoff_ab400002a6_2')">💡</div>
    <div class="element" style="top:34%; left:16%" onclick="toggleEntity('switch.sonoff_ab400002a3_2')">💡</div>
    <div class="element" style="top:71%; left:40%" onclick="toggleEntity('switch.sonoff_ab400002a9_2')">💡</div>
    <div class="element" style="top:33%; left:2%" onclick="toggleEntity('switch.sonoff_ab400002a2_3')">💡</div>
    <div class="element" style="top:84%; left:1%" onclick="toggleEntity('switch.sonoff_ab400002a2_4')">💡</div>
    <div class="element" style="top:73%; left:20%" onclick="toggleEntity('switch.sonoff_ab400002a6_3')">💡</div>
    <div class="element" style="top:39%; left:27%" onclick="toggleEntity('switch.sonoff_ab400002a4_3')">💡</div>
    <div class="element" style="top:13%; left:74%" onclick="toggleEntity('switch.sonoff_ab4000029f_1')">💡</div>
    <div class="element" style="top:13%; left:68%" onclick="toggleEntity('switch.sonoff_ab4000029f_3')">💡</div>
    <div class="element" style="top:13%; left:63%" onclick="toggleEntity('switch.sonoff_ab4000029f_4')">💡</div>
    <div class="element" style="top:13%; left:56%" onclick="toggleEntity('switch.sonoff_ab4000029f_2')">💡</div>
    <div class="element" style="top:42%; left:59%" onclick="toggleEntity('switch.sonoff_ab400002a7_4')">💡</div>
    <div class="element" style="top:35%; left:40%" onclick="toggleEntity('switch.sonoff_ab400002a1_1')">💡</div>
    <div class="element" style="top:27%; left:69%" onclick="toggleEntity('switch.sonoff_ab4000028a_1')">💡</div>
    <div class="element" style="top:26%; left:77%" onclick="toggleEntity('switch.sonoff_ab400002a9_3')">💡</div>
    <div class="element" style="top:38%; left:69%" onclick="toggleEntity('switch.sonoff_ab400002a5_3')">💡</div>
    <div class="element" style="top:50%; left:77%" onclick="toggleEntity('switch.sonoff_ab400002a5_4')">💡</div>
    <div class="element" style="top:38%; left:77%" onclick="toggleEntity('switch.sonoff_ab400002a0_1')">💡</div>
    <div class="element" style="top:50%; left:69%" onclick="toggleEntity('switch.sonoff_ab400002a0_2')">💡</div>
    <div class="element" style="top:60%; left:77%" onclick="toggleEntity('switch.sonoff_ab400002a9_1')">💡</div>
    <div class="element" style="top:60%; left:70%" onclick="toggleEntity('switch.sonoff_ab400002a5_2')">💡</div>
    <div class="element" style="top:80%; left:49%" onclick="toggleEntity('switch.sonoff_ab400002a1_3')">💡</div>
    <div class="element" style="top:80%; left:65%" onclick="toggleEntity('switch.sonoff_ab4000029e_3')">💡</div>
    <div class="element" style="top:80%; left:55%" onclick="toggleEntity('switch.sonoff_ab400002a3_4')">💡</div>
    <div class="element" style="top:80%; left:60%" onclick="toggleEntity('switch.sonoff_ab4000029e_2')">💡</div>
    <div class="element" style="top:54%; left:58%" onclick="toggleEntity('switch.sonoff_ab400002a1_4')">💡</div>
    <div class="element" style="top:63%; left:54%" onclick="toggleEntity('switch.sonoff_ab400002a4_2')">💡</div>

    <!-- Doors -->
    <div class="element" style="top:49%; left:40%; transform: scale(1.5)" onclick="toggleEntity('switch.sonoff_1001f1ee4a')">🚪</div>
    <div class="element" style="top:55%; left:44%" onclick="toggleEntity('switch.sonoff_1001f1ee4a')">🚪</div>
    <div class="element" style="top:55%; left:35%" onclick="toggleEntity('switch.sonoff_1001f1ee4a')">🚪</div>

    <div class="element" style="top:45%; left:73%; width:50px; height:50px; line-height:50px; border-radius:50%; background-color: rgba(255,255,255,0.0); transform: scale(1.5)">🚪</div>
    <div class="element" style="top:75%; left:7%" onclick="toggleEntity('script.1708014031917')">🚪</div>
    <div class="element" style="top:40%; left:7%" onclick="toggleEntity('script.1709208919303')">🚪</div>
    <div class="element" style="top:73%; left:55%" onclick="toggleEntity('script.1709208983300')">🚪</div>
    <div class="element" style="top:75%; left:60%" onclick="toggleEntity('script.1709208954574')">🚪</div>
    <div class="element" style="top:76%; left:51%" onclick="toggleEntity('script.1709208997961')">🚪</div>
    <div class="element" style="top:73%; left:66%" onclick="toggleEntity('script.1709212134770')">🚪</div>
    <div class="element" style="top:63%; left:68%" onclick="toggleEntity('script.lock26_duplicate')">🚪</div>
    <div class="element" style="top:53%; left:68%" onclick="toggleEntity('script.lock25_duplicate')">🚪</div>
    <div class="element" style="top:43%; left:68%" onclick="toggleEntity('script.lock24_duplicate')">🚪</div>
    <div class="element" style="top:33%; left:68%" onclick="toggleEntity('script.lock23_duplicate')">🚪</div>
    <div class="element" style="top:58%; left:54%" onclick="toggleEntity('script.1709212152765')">🚪</div>
    <div class="element" style="top:48%; left:54%" onclick="toggleEntity('script.lock20_duplicate')">🚪</div>
    <div class="element" style="top:67%; left:53%" onclick="toggleEntity('script.lock14_duplicate')">🚪</div>
    <div class="element" style="top:36%; left:55%" onclick="toggleEntity('script.lock21_duplicate')">🚪</div>
    <div class="element" style="top:27%; left:55%" onclick="toggleEntity('script.lock22_duplicate')">🚪</div>
    <div class="element" style="top:18%; left:71%" onclick="toggleEntity('script.lock10_duplicate')">🚪</div>
    <div class="element" style="top:18%; left:65%" onclick="toggleEntity('script.lock11_duplicate')">🚪</div>
    <div class="element" style="top:18%; left:60%" onclick="toggleEntity('script.lock12_duplicate')">🚪</div>
    <div class="element" style="top:18%; left:57%" onclick="toggleEntity('script.lock13_duplicate')">🚪</div>

    <!-- Curtains -->
    <!-- <div class="element" style="top:41%; left:88%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:76%; left:74%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:23%; left:70%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:89%; left:20%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:58%; left:2%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:8%; left:20%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div>
    <div class="element" style="top:23%; left:1%" onclick="toggleEntity('script.1708014031917')">🔺🔻</div> -->

  </div>

  <script>
    function toggleEntity(entityId) {
      fetch(`/toggle/${entityId}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          if(data.status === "success"){
            console.log(entityId + " toggled");
          } else {
            console.error(data.details);
          }
        });
    }
  </script>
</body>

<!-- <script>
  // يغير شكل الأيقونة بناءً على الحالة
  function updateIcon(element, state) {
    if (state === "on") {
      element.style.opacity = "1";   // منورة
      element.textContent = "💡";    // لمبة شغالة
    } else {
      element.style.opacity = "0.3"; // مطفية
      element.textContent = "💡";    // لمبة مطفية
    }
  }

  // يجيب حالة جهاز واحد
  function fetchState(entityId, element) {
    fetch(`/state/${entityId}`)
      .then(res => res.json())
      .then(data => {
        updateIcon(element, data.state);
      });
  }

  // لما يضغط المستخدم يرسل toggle ويحدث الحالة مباشرة
  function toggleEntity(entityId, element) {
    fetch(`/toggle/${entityId}`, { method: 'POST' })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          fetchState(entityId, element);
        }
      });
  }

  // عند بداية الصفحة
  document.querySelectorAll(".element").forEach(el => {
    const entityId = el.getAttribute("onclick").match(/'(.*?)'/)[1];
    el.setAttribute("onclick", `toggleEntity("${entityId}", this)`);
    fetchState(entityId, el);
  });

  // تحديث كل 5 ثواني
  setInterval(() => {
    document.querySelectorAll(".element").forEach(el => {
      const entityId = el.getAttribute("onclick").match(/"(.*?)"/)[1];
      fetchState(entityId, el);
    });
  }, 5000);
</script> -->

</html>
